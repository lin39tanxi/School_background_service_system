<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.we_are_team.school_background_service_system.mapper.LostAndFoundMapper">
    <update id="updateLostFoundByItemId" >
        update lost_and_found
        <set>
            <if test="lostAndFound.itemName != null">
                item_name = #{lostAndFound.itemName},
            </if>
            <if test="lostAndFound.categoryId != null">
                category_id = #{lostAndFound.categoryId},
            </if>
            <if test="lostAndFound.locationId != null">
                location_id = #{lostAndFound.locationId},
            </if>
            <if test="lostAndFound.description != null">
                description = #{lostAndFound.description},
            </if>
            <if test="lostAndFound.imageUrls != null">
                image_urls = #{lostAndFound.imageUrls},
            </if>
            <if test="lostAndFound.status != null">
                status = #{lostAndFound.status},
            </if>
            <if test="lostAndFound.adminId != null">
                admin_id = #{lostAndFound.adminId},
            </if>
            <if test="lostAndFound.updatedTime != null">
                updated_time = #{lostAndFound.updatedTime},
            </if>
        </set>
        where item_id = #{lostAndFound.itemId}
    </update>

    <select id="getLostAndFoundList" resultType="com.we_are_team.school_background_service_system.pojo.vo.GetLostAndFoundVO">
        select lf.item_id, lf.item_name, lf.description, lf.image_urls, lf.status,
        c.category_name as category_name,
        l.location_name as location_name
        from lost_and_found lf
        left join item_category c on lf.category_id = c.category_id
        left join location_category l on lf.location_id = l.location_id
        <where>
            <if test="orderKey != null and orderKey != ''">
                and (lf.description LIKE CONCAT('%', #{orderKey}, '%') OR lf.item_name LIKE CONCAT('%', #{orderKey}, '%')) 
            </if>
            <if test="beginTime != null">
                and lf.created_time >= #{beginTime}
            </if>
            <if test="endTime != null">
                and lf.created_time &lt;= #{endTime}
            </if>
            <if test="status != null and status != ''">
                and lf.status = #{status}
            </if>
        <if test="categoryId != null and categoryId != ''">
            and lf.category_id = #{categoryId}
        </if>
        <if test="locationId != null and locationId != ''">
            and lf.location_id = #{locationId}
        </if>
        </where>
        order by lf.created_time  desc
    </select>
    <select id="getLostAndFoundDetail" resultType="com.we_are_team.school_background_service_system.pojo.entity.LostAndFound">
        select lf.item_id, lf.item_name, lf.description, lf.image_urls, lf.status,lf.admin_id,
        c.category_name as category_name,
        l.location_name as location_name,
        lf.created_time, lf.updated_time
        from lost_and_found lf
        left join item_category c on lf.category_id = c.category_id
        left join location_category l on lf.location_id = l.location_id
        where lf.item_id = #{itemId}
    </select>
</mapper>